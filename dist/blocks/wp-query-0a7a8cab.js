/*!
 * 
 * prcBlocksLibrary
 * 
 * @author Seth Rubenstein
 * @version 0.1.0
 * @link UNLICENSED
 * @license UNLICENSED
 * 
 * Copyright (c) 2021 Seth Rubenstein
 * 
 * This software is released under the UNLICENSED License
 * https://opensource.org/licenses/UNLICENSED
 * 
 * Compiled with the help of https://wpack.io
 * A zero setup Webpack Bundler Script for WordPress
 */
(window.wpackioprcBlocksLibraryblocksJsonp=window.wpackioprcBlocksLibraryblocksJsonp||[]).push([[24],{0:function(e,t){e.exports=wp.element},1:function(e,t){e.exports=React},131:function(e){e.exports=JSON.parse('{"apiVersion":2,"name":"prc-block/wp-query","category":"layout","attributes":{"disableImage":{"type":"boolean","default":false},"formatTermId":{"type":"integer"},"labelTaxonomy":{"type":"string","default":"formats"},"pinned":{"type":"string","default":"[]"},"postsPerPage":{"type":"integer","default":5},"programTermId":{"type":"integer"},"taxQuery":{"type":"object","default":{"relation":"OR","data":[]}}},"providesContext":{"prc-block/wp-query":"pinned"}}')},2:function(e,t){e.exports=wp.i18n},225:function(e,t,n){n(16),e.exports=n(234)},233:function(e,t,n){},234:function(e,t,n){"use strict";n.r(t);var a=n(5),r=n(6),o=n(2),l=n(131),c=n(19),i=n(0),s=n(8),u=n(3),m=n(4),p=n(273);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d=function(e){var t=e.index,n=e.label,a=e.taxonomy,r=void 0!==a&&a,l=e.value,c=e.options,i=e.taxQuery,s=e.setAttributes;return React.createElement("div",null,React.createElement(m.Flex,null,React.createElement(m.FlexBlock,null,React.createElement("strong",null,n)),React.createElement(m.FlexItem,null,React.createElement(m.Button,{isLink:!0,icon:p.a,onClick:function(){var e=i;e.data.splice(t,1),s({taxQuery:f(f({},i),e)})},lable:Object(o.__)("Remove taxonomy argument")}))),!1===r&&React.createElement("div",{style:{margin:"16px"}},React.createElement(m.SelectControl,{value:r,options:c,onChange:function(e){var n=i;n.data[t].taxonomy=e,s({taxQuery:f(f({},i),n)})}})),!1!==r&&null===l&&React.createElement(u.__experimentalLinkControl,{label:Object(o.__)("Term"),value:l,showInitialSuggestions:!0,suggestionsQuery:{type:"term",subtype:r},onChange:function(e){var n=e.id,a=e.title,r=e.url,o=i;o.data[t].terms=n,o.data[t].title=a,o.data[t].value=r,s({taxQuery:f(f({},i),o)})},settings:[]}),React.createElement(m.HorizontalRule,null))},g=function(e){var t=e.taxQuery,n=e.setAttributes,a=t.relation,r=t.data,l=Object(i.useState)([{label:"Select a Taxonomy",value:!1},{label:"Topics",value:"topic"},{label:"Formats",value:"formats"},{label:"Programs",value:"programs"}]),s=Object(c.a)(l,2),u=s[0],p=s[1];return Object(i.useEffect)((function(){var e=r.map((function(e){return e.taxonomy})),t=u.map((function(t){return e.includes(t.value)?t.disabled=!0:t.disabled=!1,t}));p(t)}),[t]),React.createElement(i.Fragment,null,React.createElement("div",null,r.map((function(e,a){var r=e.taxonomy,l=e.value,c=function(e){var t=e.taxonomy,n=e.title,a=!1===t?"Choose Taxonomy":"Choose ".concat(t," Term");return null!==n&&!1!==t&&(a="".concat(t,": ").concat(n)),a.toLowerCase().split(" ").map((function(e){return e.charAt(0).toUpperCase()+e.substring(1)})).join(" ")}(e);return React.createElement(d,{index:a,label:Object(o.__)(c),taxonomy:r,value:l,options:u,taxQuery:t,setAttributes:n})})),2<=r.length&&React.createElement("div",{style:{marginTop:"1em",marginBottom:"1em"}},React.createElement(m.ToggleControl,{label:"Query Relation (OR|AND)",help:"AND"===a?"AND (restrictive: restricts content)":"OR (expansive: expands content)",checked:"AND"===a,onChange:function(){var e=t;"OR"===e.relation?e.relation="AND":e.relation="OR",n({taxQuery:f(f({},t),e)})}}))),React.createElement(m.Button,{isSecondary:!0,isSmall:!0,onClick:function(){var e=t;e.data.push({taxonomy:!1,terms:null,value:null}),n({taxQuery:f(f({},t),e)})}},"Add Taxonomy"))},y=n(39),v=n(32),x=n.n(v),O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25;return new Promise((function(n){var a={};x()({path:"/wp/v2/".concat(e,"?per_page=").concat(t)}).then((function(t){for(var r=0;r<t.length;r++){var o=t[r].slug.replace("".concat(e.toLowerCase(),"_"),"");a[t[r].id]={id:t[r].id,name:t[r].name,parent:t[r].parent,slug:o}}n(a)}))}))},h=(n(41),n(162),n(274),n(98),n(42),n(233),n(134),function(e){return new Promise((function(t){var n=[];console.log("fetchPosts?",e);var a={method:"POST",path:"/prc-api/v2/block/wp-query",data:e};x()(a).then((function(e){console.log(e),e.forEach((function(e){var t,a={id:e.id,title:e.title,excerpt:e.excerpt,date:(t=e.timestamp,y(t).format("MMM D, YYYY")),link:e.link,label:e.label,image:e.image};n.push(a)})),t(n)}))}))}),E=function(e){var t=e.attributes,n=e.setAttributes,a=e.wide,r=void 0!==a&&a,l=e.disabled,s=void 0!==l&&l,u=t.formatTermId,p=t.programTermId,b=t.postsPerPage,f=t.labelTaxonomy,d=t.disableImage,y=t.taxQuery,v=Object(i.useState)([]),x=Object(c.a)(v,2),h=x[0],E=x[1],R=Object(i.useState)([]),j=Object(c.a)(R,2),k=j[0],P=j[1],w=function(e,n){console.log("initTerms",t),O(e).then((function(e){var t=Object.keys(e),a=[{value:"any",label:"Any"}];t.forEach((function(t){a.push({value:t,label:e[t].name})})),n(a)}))};return Object(i.useEffect)((function(){0===h.length&&w("Formats",E),0===k.length&&w("Programs",P)}),[]),React.createElement(i.Fragment,null,React.createElement("div",null,React.createElement("h4",{className:"sans-serif"},"Story Item Settings"),React.createElement(m.ToggleControl,{label:"Disable Images",checked:d,onChange:function(){return n({disableImage:!d})}}),React.createElement("div",{style:!0===r?{display:"flex",flexDirection:"row"}:{}},React.createElement("div",{style:!0===r?{flexGrow:"1",paddingRight:"1em"}:{}},React.createElement(m.SelectControl,{label:"Format",value:u,options:h,onChange:function(e){n({formatTermId:parseInt(e)})},disabled:s})),React.createElement("div",{style:!0===r?{display:"flex",alignItems:"flex-end",paddingBottom:"0.2em"}:{}},React.createElement(m.ToggleControl,{label:"Use as Label",checked:"formats"===f,onChange:function(){return n({labelTaxonomy:"formats"===f?"programs":"formats"})}}))),React.createElement("div",{style:!0===r?{display:"flex",flexDirection:"row"}:{}},React.createElement("div",{style:!0===r?{flexGrow:"1",paddingRight:"1em"}:{}},React.createElement(m.SelectControl,{label:"Program",value:p,options:k,onChange:function(e){n({programTermId:parseInt(e)})},disabled:s})),React.createElement("div",{style:!0===r?{display:"flex",alignItems:"flex-end",paddingBottom:"0.2em"}:{}},React.createElement(m.ToggleControl,{label:"Use as Label",checked:"programs"===f,onChange:function(){return n({labelTaxonomy:"programs"===f?"formats":"programs"})}})))),React.createElement(m.HorizontalRule,null),React.createElement("div",null,React.createElement("h4",{className:"sans-serif"},"Query Arguments"),React.createElement(m.RangeControl,{label:Object(o.__)("Number of posts"),value:b,onChange:function(e){return n({postsPerPage:e})},min:3,max:10,required:!0})),React.createElement(m.HorizontalRule,null),React.createElement("div",null,React.createElement("h4",{className:"sans-serif"},"Taxonomy Query Arguments"),React.createElement(g,{taxQuery:y,setAttributes:n})),React.createElement(m.HorizontalRule,null))},R=function(e){var t=e.attributes,n=e.setAttributes,a=e.setPosts,r=e.clientId,l=Object(i.useState)(!1),p=Object(c.a)(l,2),b=p[0],f=p[1],d=Object(s.useSelect)((function(e){return{hasInnerBlocks:0<e("core/block-editor").getBlocks(r).length}}),[r]).hasInnerBlocks,g=function(){f(!0),h(t).then((function(e){setTimeout((function(){f(!1),a(e)}),3600)}))};return React.createElement(i.Fragment,null,React.createElement(u.InspectorControls,null,React.createElement(m.PanelBody,{title:Object(o.__)("Query Arguments")},React.createElement(E,{attributes:t,setAttributes:n,disabled:b}),React.createElement(m.Button,{isBusy:b,isPrimary:!0,onClick:function(){return g()}},"Update"))),!1===d&&React.createElement(m.Placeholder,{label:"Configure Query Args",isColumnLayout:!0},React.createElement("div",null,React.createElement(E,{attributes:t,setAttributes:n,disabled:b,wide:!0}),React.createElement(m.Button,{isBusy:b,isPrimary:!0,onClick:function(){return g()}},"Query Posts"))))},j=["prc-block/story-item"],k=function(e){var t=e.attributes,n=e.setAttributes,a=e.className,o=e.clientId,l=t.pinned,m=t.postsPerPage,p=t.labelTaxonomy,b=t.disableImage,f=Object(u.useBlockProps)({className:a}),d=Object(u.__experimentalUseInnerBlocksProps)({allowedBlocks:j,orientation:"vertical",renderAppender:u.InnerBlocks.ButtonBlockAppender}),g=Object(i.useState)(!1),y=Object(c.a)(g,2),v=y[0],x=y[1],O=Object(s.useDispatch)("core/block-editor").replaceInnerBlocks,h=Object(s.useSelect)((function(e){var t=e("core/block-editor").getBlocks(o);return{innerBlocks:t,hasInnerBlocks:0<t.length}}),[o]),E=h.innerBlocks,k=h.hasInnerBlocks;return Object(i.useEffect)((function(){if(!1!==v){var e=[];v.forEach((function(t){e.push(function(e,t,n){var a={title:e.title,image:e.image,excerpt:e.excerpt,link:e.link,label:e.label,date:e.date,extra:"",postID:e.id,emphasis:!1,isChartArt:!1,imageSlot:"left",imageSize:"A3",horizontal:!0,stacked:!1,enableHeader:!0,enableExcerpt:!0,enableExtra:!1,enableProgramsTaxonomy:!1,headerSize:2,className:"is-style-left"};return!0===t&&(a.imageSlot="disabled",a.className="is-style-disabled",a.enableExcerpt=!1),"programs"===n&&(a.enableProgramsTaxonomy=!0),Object(r.createBlock)("prc-block/story-item",a)}(t,b,p))}));var t=[];JSON.parse(l).forEach((function(n){E.filter((function(t){var a=e.filter((function(e){return e.attributes.postID===n}));return t.attributes.postID===n&&0>=a.length})).forEach((function(e){return t.push(e)}))}));var n=m-t.length;e=e.filter((function(e,t){return t<=n-1}));var a=t.concat(e);O(o,a)}}),[v]),React.createElement("div",f,React.createElement(R,{attributes:t,setAttributes:n,setPosts:x,clientId:o}),!0===k&&React.createElement("div",d))},P=function(){return React.createElement(u.InnerBlocks.Content,null)};function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){Object(a.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=l.name,B={title:Object(o.__)("Query"),description:Object(o.__)("Query posts by format, topic, region, and/or date. Posts are displayed as Story Items."),edit:k,save:P};Object(r.registerBlockType)(C,I(I({},l),B))},3:function(e,t){e.exports=wp.blockEditor},32:function(e,t){e.exports=wp.apiFetch},39:function(e,t){e.exports=moment},4:function(e,t){e.exports=wp.components},42:function(e,t){e.exports=wp.url},6:function(e,t){e.exports=wp.blocks},76:function(e,t){e.exports=ReactDOM},8:function(e,t){e.exports=wp.data}},[[225,0,1,23]]]);
//# sourceMappingURL=wp-query-0a7a8cab.js.map