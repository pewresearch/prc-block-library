{"version":3,"sources":["webpack:///external [\"wp\",\"element\"]","webpack:///external [\"wp\",\"apiFetch\"]","webpack:///external [\"wp\",\"keycodes\"]","webpack:///external [\"wp\",\"url\"]","webpack:///external \"moment\"","webpack:///external [\"wp\",\"components\"]","webpack:///./src/mailchimp-opt-down/frontend.js","webpack:///external [\"wp\",\"i18n\"]","webpack:///./src/mailchimp-opt-down/component.js","webpack:///external [\"wp\",\"blocks\"]","webpack:///external [\"wp\",\"compose\"]","webpack:///external [\"wp\",\"data\"]","webpack:///external [\"wp\",\"blockEditor\"]"],"names":["module","exports","window","moment","onload","document","querySelector","query","URLSearchParams","location","search","querySelectorAll","elm","props","interests","mailChimpInterests","map","d","value","emailAddress","get","render","MailchimpOptDown","withState","error","loading","list_id","choice","dimmerActive","dimmerMessage","setState","console","log","JSON","stringify","style","fontFamily","color","hidden","className","Field","Input","label","placeholder","name","data-validate","required","onChange","e","target","size","i","Checkbox","inline","readonly","defaultChecked","disabled","onClick","preventDefault","email","test","validate_email","updated_interests","jQuery","each","extend","this","val","is","setTimeout","ajax","url","siteURL","param","type","fail","responseJSON","data","status","done","info"],"mappings":"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","file":"mailchimp-opt-down/frontend-6409e2ba.js","sourcesContent":["(function() { module.exports = window[\"wp\"][\"element\"]; }());","(function() { module.exports = window[\"wp\"][\"apiFetch\"]; }());","(function() { module.exports = window[\"wp\"][\"keycodes\"]; }());","(function() { module.exports = window[\"wp\"][\"url\"]; }());","module.exports = moment;","(function() { module.exports = window[\"wp\"][\"components\"]; }());","import { render } from '@wordpress/element';\nimport { mailChimpInterests } from '@pewresearch/app-components';\nimport MailchimpOptDown from './component';\n\n// When the document is fully loaded load the mailchimp-form\nwindow.onload = () => {\n    if (document.querySelector('.mailchimp-opt-down') && !document.querySelector('body.wp-admin')) {\n        const query = new URLSearchParams(window.location.search);\n        const elms = document.querySelectorAll('.mailchimp-opt-down',);\n\n        // eslint-disable-next-line no-restricted-syntax\n        for (const elm of elms) {\n             const props = {\n                 interests: mailChimpInterests.map(d => d.value),\n                 emailAddress: typeof query.get('email') !== 'undefined' ? query.get('email') : ``,\n             };\n            render(<MailchimpOptDown {...props} />, elm);\n        }\n    }\n};\n","(function() { module.exports = window[\"wp\"][\"i18n\"]; }());","import { Component, Fragment, RawHTML } from '@wordpress/element';\nimport { withState } from '@wordpress/compose';\nimport { Form, Input, Dimmer, Button, Message } from 'semantic-ui-react';\n\nconst defaultState = {\n    error: false,\n    loading: false,\n    list_id: 'a33430a835', // Mailchimp ID for Quarterly Update newsletter\n    choice: true,\n    dimmerActive: false,\n    dimmerMessage: '',\n};\n\nconst MailchimpOptDown = withState(defaultState)(({\n        list_id,\n        interests,\n        error,\n        loading,\n        choice,\n        emailAddress,\n        dimmerActive,\n        dimmerMessage,\n        setState,\n    }) => {\n\n        const validate_email = e => {\n          return /^.+@.+\\..+$/.test(e);\n        };\n\n        const submitHandler = e => {\n          e.preventDefault();\n          setState({\n            loading:true,\n            dimmerActive: false\n          });\n          const email = emailAddress;\n          if (!validate_email(email)) {\n            console.log('email error');\n            setState({\n              dimmerMessage: 'Please enter a valid email address.' ,\n              error: true,\n              loading:false,\n              dimmerActive: true\n            });\n\n            return;\n          }\n          let updated_interests = {};\n\n          jQuery.each(jQuery(\"input[name='interests']\"), function(){\n              jQuery.extend(updated_interests, {[jQuery(this).val()] : jQuery(this).is(\":checked\") ? true : false });\n          });\n\n          setTimeout(() => {\n              jQuery\n                  .ajax({\n                      url: `${\n                          window.siteURL\n                      }/wp-json/prc-api/v2/mailchimp/update?${jQuery.param(\n                          {\n                              email,\n                              interests: updated_interests,\n                          })}`,\n                      type: 'POST',\n                  })\n                  .fail( e => {\n                    console.log(e);\n                    if (e.responseJSON.data.status == '404') {\n                      setState({\n                          dimmerMessage:\n                              'We could not find that email address in our records.',\n                          error: true,\n                          loading:false,\n                          dimmerActive: true\n                      });\n                    }\n                  })\n                  .done(() => {\n                      console.info('Succesfully subscribed');\n                      setState({\n                          dimmerMessage:\n                              'You have succesfully updated your preferences.',\n                          error: false,\n                          loading:false,\n                          dimmerActive: true\n                      });\n                  })\n          });\n\n        };\n\n\n        console.log(JSON.stringify(interests));\n        console.log(emailAddress);\n\n        return (\n          <>\n            <Message\n              style={{fontFamily: 'franklin-gothic-urw'}}\n              color={ error ? 'red' : 'green'}\n              hidden={!dimmerActive }>\n              {dimmerMessage}\n            </Message>\n            <Form className=\"mailchimp-opt-down\">\n              <Form.Field>\n              <Form.Input\n                label=\"Email\"\n                placeholder=\"Your email address\"\n                name=\"email\"\n                data-validate=\"mc-email\"\n                required\n                value={emailAddress}\n                onChange={ e => { setState({emailAddress: e.target.value}) } }\n                size=\"big\"\n                />\n                </Form.Field>\n                { interests.map( (d,i) =>\n                  <Form.Field>\n                    <Form.Checkbox\n                      inline\n                      name=\"interests\"\n                      label={<label style={{fontFamily: 'franklin-gothic-urw'}}> {d.value === list_id ? `Send me quarterly updates and unsubscribe from all other newsletters.` : d.label }</label>}\n                      value={d.value}\n                      readonly={d.value !== list_id ? true : false }\n                      defaultChecked={d.value === list_id ? true : false }\n                      style={{ 'display' : d.value !== list_id ? `none` : `inherit` }}\n                      onChange={ e => { setState({choice: !choice }) } }\n                    />\n                  </Form.Field>\n                )}\n              <Button disabled={ !choice || document.querySelector('body.wp-admin') } onClick={submitHandler} loading={loading}>Update preferences</Button>\n            </Form>\n          </>\n        );\n    },\n);\n\nexport default MailchimpOptDown;\n","(function() { module.exports = window[\"wp\"][\"blocks\"]; }());","(function() { module.exports = window[\"wp\"][\"compose\"]; }());","(function() { module.exports = window[\"wp\"][\"data\"]; }());","(function() { module.exports = window[\"wp\"][\"blockEditor\"]; }());"],"sourceRoot":""}