{"version":3,"file":"view.js","mappings":"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","sources":["webpack://popup-controller/webpack/bootstrap","webpack://popup-controller/webpack/runtime/compat get default export","webpack://popup-controller/webpack/runtime/define property getters","webpack://popup-controller/webpack/runtime/hasOwnProperty shorthand","webpack://popup-controller/external window [\"wp\",\"domReady\"]","webpack://popup-controller/./src/video-handlers.js","webpack://popup-controller/./src/view.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = window[\"wp\"][\"domReady\"];","/**\n * External Dependencies\n */\n\n/**\n * WordPress Dependencies\n */\n\n/**\n * Internal Dependencies\n */\n\nfunction loadYoutubePlayer(videoProvider, popupController) {\n\tconst iframe = videoProvider.querySelector(\n\t\t'.wp-block-embed__wrapper > iframe'\n\t);\n\n\tlet id = iframe.getAttribute('id');\n\n\tif (!id) {\n\t\tid = `video${Math.floor(Math.random() * 1000)}`;\n\t\tiframe.setAttribute('id', id);\n\t\t// set enablejsapi to 1\n\t\tconst src = iframe.getAttribute('src');\n\t\tiframe.setAttribute('src', `${src}&enablejsapi=1`);\n\t}\n\n\tconst videoId = iframe.getAttribute('src').split('embed/')[1].split('?')[0];\n\t// If desired we could add GA tracking here.\n\n\tconst Youtube = window.hasOwnProperty('YT') ? window.YT : false;\n\tlet p = false;\n\tif (false !== Youtube && Youtube.hasOwnProperty('Player')) {\n\t\tp = new Youtube.Player(id, {\n\t\t\tvideoId,\n\t\t});\n\t}\n\n\treturn p;\n}\n\nfunction loadVimeoPlayer(videoProvider, popupController) {\n\tconst trigger = popupController.querySelector(\n\t\t'.wp-block-prc-block-popup-content'\n\t);\n\n\tconst iframe = videoProvider.querySelector('iframe');\n\n\tlet id = iframe.getAttribute('id');\n\n\tif (!id) {\n\t\tid = `video${Math.floor(Math.random() * 1000)}`;\n\t\tiframe.setAttribute('id', id);\n\t}\n\n\tiframe.setAttribute('allow', 'autoplay');\n\n\tconst Vimeo = window.hasOwnProperty('Vimeo') ? window.Vimeo : false;\n\tconst player = new Vimeo.Player(iframe);\n\n\t// Initialize the player on hover to avoid loading the video on page load.\n\tif (false !== player) {\n\t\t// When mouse enters the trigger zone console.log('mouseenter');\n\t\ttrigger.addEventListener('mouseenter', () => {\n\t\t\tplayer.ready().then(() => {\n\t\t\t\t// the player is ready\n\t\t\t\tconsole.log('the player is ready');\n\t\t\t});\n\t\t});\n\t} else {\n\t\tconsole.error('Vimeo player not found');\n\t}\n\n\treturn {\n\t\tprovider: 'vimeo',\n\t\tplayVideo: () => {\n\t\t\tplayer\n\t\t\t\t.play()\n\t\t\t\t.then(() => {\n\t\t\t\t\tconsole.log('the video was played');\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tconsole.log('error...', error);\n\t\t\t\t\tswitch (error.name) {\n\t\t\t\t\t\tcase 'PasswordError':\n\t\t\t\t\t\t\t// the video is password-protected and the viewer needs to enter the\n\t\t\t\t\t\t\t// password first\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'PrivacyError':\n\t\t\t\t\t\t\t// the video is private\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// some other error occurred\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t\tstopVideo: () => {\n\t\t\tplayer\n\t\t\t\t.unload()\n\t\t\t\t.then(() => {\n\t\t\t\t\tconsole.log('the video was unloaded');\n\t\t\t\t})\n\t\t\t\t.catch((error) => {\n\t\t\t\t\tswitch (error.name) {\n\t\t\t\t\t\tcase 'PasswordError':\n\t\t\t\t\t\t\t// the video is password-protected and the viewer needs to enter the\n\t\t\t\t\t\t\t// password first\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'PrivacyError':\n\t\t\t\t\t\t\t// the video is private\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t// some other error occurred\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\t};\n}\n\nexport default function loadVideoHandler(popupController) {\n\tlet provider = false;\n\n\tif (\n\t\t!popupController ||\n\t\t!popupController.classList.contains('is-style-video')\n\t) {\n\t\treturn {\n\t\t\tprovider,\n\t\t};\n\t}\n\n\tconst isCoreEmbedBlock = popupController.querySelector(\n\t\t'.wp-block-embed.is-type-video'\n\t);\n\tif (isCoreEmbedBlock) {\n\t\tprovider = isCoreEmbedBlock.classList\n\t\t\t.toString()\n\t\t\t.split(' ')\n\t\t\t.find((className) => className.includes('is-provider-'))\n\t\t\t.replace('is-provider-', '');\n\t}\n\n\tconst isVimeoBlock = popupController.querySelector(\n\t\t'.wp-block-vimeo-create'\n\t);\n\tif (isVimeoBlock) {\n\t\tprovider = 'vimeo';\n\t}\n\n\tconst videoProvider = isCoreEmbedBlock || isVimeoBlock;\n\n\tif (!videoProvider) {\n\t\treturn {\n\t\t\tprovider,\n\t\t};\n\t}\n\n\treturn {\n\t\tprovider,\n\t\tloadPlayer: () => {\n\t\t\tswitch (provider) {\n\t\t\t\tcase 'youtube':\n\t\t\t\t\treturn loadYoutubePlayer(videoProvider, popupController);\n\t\t\t\tcase 'vimeo':\n\t\t\t\t\treturn loadVimeoPlayer(videoProvider, popupController);\n\t\t\t\tdefault:\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t};\n}\n","/**\n * WordPress Dependencies\n */\nimport domReady from '@wordpress/dom-ready';\n\n/**\n * Internal Dependencies\n */\nimport loadVideoHandler from './video-handlers';\n\nfunction closeModal(targetModal, provider, loadPlayer) {\n\tif ('vimeo' === provider && 'function' === typeof loadPlayer) {\n\t\tconst p = loadPlayer();\n\t\tp.stopVideo();\n\t}\n\ttargetModal.classList.remove('animate-in');\n\ttargetModal.classList.add('animate-out');\n\tsetTimeout(() => {\n\t\ttargetModal.classList.remove('active');\n\t\ttargetModal.classList.remove('animate-out');\n\t}, 1501);\n\tdocument.querySelector('body').classList.toggle('has-active-modal');\n}\n\nfunction prepareController(popupController) {\n\tconst videoHandler = loadVideoHandler(popupController);\n\tconst { provider, loadPlayer } = videoHandler;\n\n\t// get the id of the popupcontroller\n\tconst id = popupController.getAttribute('id');\n\t// set that id on the modal\n\n\tconst trigger = popupController.querySelector(\n\t\t'.wp-block-prc-block-popup-content'\n\t);\n\tconst modal = popupController.querySelector(\n\t\t'.wp-block-prc-block-popup-modal--outer'\n\t);\n\tconst closeButton = popupController.querySelector(\n\t\t'.wp-block-prc-block-popup-modal--close-button'\n\t);\n\n\tmodal.setAttribute('data-controller-id', id);\n\n\t// We need to move the modal to right before the end of the body element.\n\t// This is because the modal is a child of the popup controller, and the popup controller\n\tconst body = document.querySelector('body');\n\tbody.appendChild(modal);\n\n\tcloseButton.addEventListener('click', (event) => {\n\t\tevent.preventDefault();\n\t\tcloseModal(modal, provider, loadPlayer);\n\t});\n\n\ttrigger.addEventListener('click', (event) => {\n\t\tevent.preventDefault();\n\t\tif (!modal.classList.contains('initialized')) {\n\t\t\tmodal.classList.add('initialized');\n\t\t}\n\t\tmodal.classList.toggle('animate-in');\n\t\tsetTimeout(() => {\n\t\t\tmodal.classList.toggle('active');\n\t\t\tdocument.querySelector('body').classList.toggle('has-active-modal');\n\t\t\tif ('vimeo' === provider && 'function' === typeof loadPlayer) {\n\t\t\t\tconst p = loadPlayer();\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tp.playVideo();\n\t\t\t\t}, 1250);\n\t\t\t}\n\t\t}, 100);\n\t});\n}\n\nfunction initControllers() {\n\t// Initialize all popup controllers.\n\tdocument\n\t\t.querySelectorAll('.wp-block-prc-block-popup-controller')\n\t\t.forEach((popupController) => {\n\t\t\tprepareController(popupController);\n\t\t});\n}\n\nfunction watchForOutsideClicks() {\n\tdocument.addEventListener('click', (event) => {\n\t\tconst currentActiveModal = document.querySelector(\n\t\t\t'.wp-block-prc-block-popup-modal--outer.active.initialized'\n\t\t);\n\t\tif (!currentActiveModal) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst controllerId = currentActiveModal.getAttribute(\n\t\t\t'data-controller-id'\n\t\t);\n\n\t\t// Get currentActiveModal parent element and check if its class is .is-style-video.wp-block-prc-block-popup-controller\n\t\t// If it is, then we need to stop the video.\n\t\tconst popupController = document.querySelector(\n\t\t\t'.wp-block-prc-block-popup-controller#' + controllerId\n\t\t);\n\t\tconst modalWindow = currentActiveModal.querySelector(\n\t\t\t'.wp-block-prc-block-popup-modal'\n\t\t);\n\t\tif (currentActiveModal && !modalWindow.contains(event.target)) {\n\t\t\tlet provider = false;\n\t\t\tlet loadPlayer = false;\n\t\t\tif (popupController.classList.contains('is-style-video')) {\n\t\t\t\tconst videoHandler = loadVideoHandler(popupController);\n\t\t\t\tprovider = videoHandler?.provider;\n\t\t\t\tloadPlayer = videoHandler?.loadPlayer;\n\t\t\t}\n\t\t\tcloseModal(currentActiveModal, provider, loadPlayer);\n\t\t}\n\t});\n}\n\ndomReady(() => {\n\tinitControllers();\n\twatchForOutsideClicks();\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","window","loadVideoHandler","popupController","provider","classList","contains","isCoreEmbedBlock","querySelector","toString","split","find","className","includes","replace","isVimeoBlock","videoProvider","loadPlayer","iframe","id","getAttribute","Math","floor","random","setAttribute","src","videoId","Youtube","YT","p","Player","loadYoutubePlayer","trigger","player","Vimeo","addEventListener","ready","then","console","log","error","playVideo","play","catch","name","stopVideo","unload","loadVimeoPlayer","closeModal","targetModal","remove","add","setTimeout","document","toggle","domReady","querySelectorAll","forEach","videoHandler","modal","closeButton","appendChild","event","preventDefault","prepareController","currentActiveModal","controllerId","modalWindow","target"],"sourceRoot":""}