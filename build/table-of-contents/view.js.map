{"version":3,"file":"table-of-contents/view.js","mappings":"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","sources":["webpack://@prc/block-library/./src/table-of-contents/view.js"],"sourcesContent":["/**\n * WordPress Dependencies\n */\nimport { store, getContext, getElement } from '@wordpress/interactivity';\n\nconst { actions, state } = store('prc-block/table-of-contents', {\n\tstate: {\n\t\tget isActive() {\n\t\t\tconst context = getContext();\n\t\t\tconst { part, chapter, section } = { ...context };\n\n\t\t\tconst itemType = actions.getContextClue(context);\n\t\t\tif ('part' === itemType) {\n\t\t\t\treturn part.is_active;\n\t\t\t}\n\t\t\tif ('chapter' === itemType) {\n\t\t\t\treturn chapter.is_active;\n\t\t\t}\n\t\t\tif ('section' === itemType) {\n\t\t\t\treturn section.is_active;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t},\n\tactions: {\n\t\tonClick: (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tconst context = getContext();\n\t\t\tcontext.isDropdownOpen = !context.isDropdownOpen;\n\t\t},\n\t\tgetInternalChaptersList: () => {\n\t\t\tconst { ref } = getElement();\n\t\t\t// check if the first level of the list has list-items with is-top-level class\n\t\t\t// if so, return the first level of the list\n\t\t\tif (\n\t\t\t\tref.querySelector(\n\t\t\t\t\t'.wp-block-prc-block-table-of-contents__list .is-top-level'\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn ref.querySelector(\n\t\t\t\t\t'.wp-block-prc-block-table-of-contents__list'\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn ref.querySelector(\n\t\t\t\t'.wp-block-prc-block-table-of-contents__list .wp-block-prc-block-table-of-contents__list'\n\t\t\t);\n\t\t},\n\t\tinitSmoothScrollClickHandler: () => {\n\t\t\tconst internalChaptersList = actions.getInternalChaptersList();\n\n\t\t\tif (!internalChaptersList) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst links = internalChaptersList.querySelectorAll('a');\n\n\t\t\tif (!links) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlinks.forEach((link) => {\n\t\t\t\tlink.addEventListener('click', (e) => {\n\t\t\t\t\tconst href = link.getAttribute('href');\n\t\t\t\t\t// If the link is a hash link, we need to smooth scroll to the hash.\n\t\t\t\t\tif (0 === href.indexOf('#')) {\n\t\t\t\t\t\tconst target = document.getElementById(\n\t\t\t\t\t\t\thref.replace('#', '')\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (target) {\n\t\t\t\t\t\t\ttarget.scrollIntoView({ behavior: 'smooth' }, true);\n\t\t\t\t\t\t\t// Add the hash to the end of the URL.\n\t\t\t\t\t\t\twindow.history.pushState(null, null, href);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\t\t},\n\t\tonDropdownClick: (event) => {\n\t\t\tevent.preventDefault();\n\t\t\tconst context = getContext();\n\t\t\tcontext.isDropdownOpen = !context.isDropdownOpen;\n\t\t},\n\t\tgetContextClue: (context) => {\n\t\t\t// If context.part is defined, but context.chapter and context.section are undefined, then this is a a part. If context.chapter is defined, but context.section is undefined, then this is a chapter. If context.section is defined, then this is a section.\n\t\t\tif (context.part && !context.chapter && !context.section) {\n\t\t\t\treturn 'part';\n\t\t\t} else if (context.chapter && !context.section) {\n\t\t\t\treturn 'chapter';\n\t\t\t} else if (context.section) {\n\t\t\t\treturn 'section';\n\t\t\t}\n\t\t},\n\t},\n\tcallbacks: {\n\t\t/**\n\t\t * Remap the foundSections (generated by core/heading blocks in post_content)\n\t\t * to their respective part or chapter in their `sections` property.\n\t\t */\n\t\tmapFoundSectionsToChapters: () => {\n\t\t\tconst { sectionsFound, postId, partsEnabled } = state;\n\n\t\t\t// if no sectionsFound, return\n\t\t\tif (!sectionsFound) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Structure the sectionsFound object into an array of objects\n\t\t\tconst mappedSections = Object.entries(sectionsFound).map(\n\t\t\t\t([key, label]) => ({\n\t\t\t\t\tkey,\n\t\t\t\t\tlabel,\n\t\t\t\t\turl: `#${key}`,\n\t\t\t\t\titems: [],\n\t\t\t\t\tchapters: [],\n\t\t\t\t\tis_active: false,\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tconst { items } = getContext();\n\n\t\t\tconst unattachedPackagePartIndex = items.findIndex(\n\t\t\t\t(part) => part.key === `unattachedPackagePart_${postId}`\n\t\t\t);\n\t\t\tif (-1 !== unattachedPackagePartIndex) {\n\t\t\t\titems[unattachedPackagePartIndex].sections = mappedSections;\n\t\t\t} else if (!partsEnabled) {\n\t\t\t\tconst activeChapterIndex = items.findIndex(\n\t\t\t\t\t(chapter) => chapter.is_active === true\n\t\t\t\t);\n\t\t\t\titems[activeChapterIndex].sections = mappedSections;\n\t\t\t} else {\n\t\t\t\tconst activePartIndex = items.findIndex((part) => {\n\t\t\t\t\treturn part.chapters.find(\n\t\t\t\t\t\t(chapter) => chapter.is_active === true\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\tif (-1 === activePartIndex) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst activeChapterIndex = items[\n\t\t\t\t\tactivePartIndex\n\t\t\t\t].chapters.findIndex((chapter) => chapter.is_active === true);\n\n\t\t\t\titems[activePartIndex].chapters[activeChapterIndex].sections =\n\t\t\t\t\tmappedSections;\n\t\t\t}\n\n\t\t\t// // Set the local items.\n\t\t\t// getContext().items = items;\n\t\t},\n\t\t/**\n\t\t * Determine if the current part or chapter has list items.\n\t\t * @return {boolean}\n\t\t */\n\t\thasListItems() {\n\t\t\tconst context = getContext();\n\t\t\tconst { part, chapter } = { ...context };\n\t\t\tif (undefined === chapter && undefined !== part) {\n\t\t\t\treturn part.sections.length > 0;\n\t\t\t} else if (undefined !== chapter) {\n\t\t\t\treturn chapter.sections.length > 0;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t * Determine if the current part or chapter is active.\n\t\t * @return {boolean}\n\t\t */\n\t\tisActive() {\n\t\t\tconst context = getContext();\n\t\t\tconst { part, chapter, section } = { ...context };\n\n\t\t\tconst itemType = actions.getContextClue(context);\n\t\t\tif ('part' === itemType) {\n\t\t\t\treturn part.is_active;\n\t\t\t}\n\t\t\tif ('chapter' === itemType) {\n\t\t\t\treturn chapter.is_active;\n\t\t\t}\n\t\t\tif ('section' === itemType) {\n\t\t\t\treturn section.is_active;\n\t\t\t}\n\t\t\treturn false;\n\t\t},\n\t\t/**\n\t\t * When the client is resized, check if the dropdown should be enabled.\n\t\t */\n\t\tonResizeToggleDropdown: () => {\n\t\t\tconst context = getContext();\n\t\t\tconst { autoDropdownEnabled, autoDropdownWidth } = context;\n\t\t\tif (!autoDropdownEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { ref } = getElement();\n\t\t\t// get the width of the ref\n\t\t\tconst width = ref.offsetWidth;\n\t\t\t// if the width is less than the autoDropdownWidth and autoDropdownEnabled is true\n\t\t\t// set isDropdown to true\n\t\t\tif (width < autoDropdownWidth && autoDropdownEnabled) {\n\t\t\t\tcontext.isDropdown = true;\n\t\t\t} else {\n\t\t\t\tcontext.isDropdown = false;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * When a click event occurs inside the window,\n\t\t * but outside the dropdown target, close the dropdown.\n\t\t * @param {*} event\n\t\t */\n\t\tonWindowClickCloseDropdown: (event) => {\n\t\t\tconst context = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tif (!ref.contains(event.target) && context.isDropdown) {\n\t\t\t\tcontext.isDropdownOpen = false;\n\t\t\t}\n\t\t},\n\t\t/**\n\t\t * Scroll smoothly when clicking on a # link\n\t\t * @param {*} event\n\t\t */\n\t\tscrollSmoothly: (event) => {\n\t\t\tconst context = getContext();\n\t\t\tconst { section } = context;\n\t\t\tconst { key } = section;\n\t\t\tevent.preventDefault();\n\t\t\tconst target = document.getElementById(key);\n\n\t\t\tif (target) {\n\t\t\t\ttarget.scrollIntoView({ behavior: 'smooth' }, true);\n\t\t\t\twindow.history.pushState(null, null, `#${key}`);\n\t\t\t}\n\t\t\tcontext.isDropdownOpen = false;\n\t\t},\n\t\t// Section Scroll\n\t\t/**\n\t\t * Initialize the watch for section scroll if this specific block has it enabled.\n\t\t */\n\t\tinitWatchForSectionScroll: () => {\n\t\t\tconst context = getContext();\n\t\t\tconst { highlightCurrentSection } = context;\n\t\t\tif (true === highlightCurrentSection) {\n\t\t\t\tstate.enableWatchForSectionScroll = true;\n\t\t\t}\n\t\t},\n\t\twatchForCurrentSection: () => {\n\t\t\tconst context = getContext();\n\t\t\tif (\n\t\t\t\t!state.enableWatchForSectionScroll &&\n\t\t\t\t!context.highlightCurrentSection\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst { key } = context.section;\n\t\t\tconst { currentSection } = state;\n\t\t\tcontext.section.is_active = key === currentSection;\n\t\t},\n\t\t/**\n\t\t * This runs exclusivley against core/heading blocks.\n\t\t * This function watches the scroll position of the page and determines if the current\n\t\t * heading is in view. If it is, it sets the currentSection to the id of the heading.\n\t\t */\n\t\twatchForSectionScroll: () => {\n\t\t\tif (!state.enableWatchForSectionScroll) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst sections = state.sectionsFound;\n\t\t\tif (!sections) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst sectionKeys = Object.keys(sections);\n\t\t\tif (!sectionKeys.length) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst threshold = 50;\n\t\t\tconst scrollPosition = window.scrollY;\n\n\t\t\tlet currentSectionKey = null;\n\n\t\t\tfor (let i = 0; i < sectionKeys.length; i++) {\n\t\t\t\tconst key = sectionKeys[i];\n\t\t\t\tconst sectionElement = document.getElementById(key);\n\t\t\t\tif (!sectionElement) continue;\n\t\t\t\tconst sectionTop = sectionElement.offsetTop;\n\t\t\t\tif (sectionTop - scrollPosition <= threshold) {\n\t\t\t\t\tcurrentSectionKey = key;\n\t\t\t\t} else {\n\t\t\t\t\t// As soon as we find a section below the threshold, stop\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstate.currentSection = currentSectionKey;\n\t\t},\n\t},\n});\n"],"names":["actions","state","store","isActive","context","getContext","part","chapter","section","itemType","getContextClue","is_active","onClick","event","preventDefault","isDropdownOpen","getInternalChaptersList","ref","getElement","querySelector","initSmoothScrollClickHandler","internalChaptersList","links","querySelectorAll","forEach","link","addEventListener","e","href","getAttribute","indexOf","target","document","getElementById","replace","scrollIntoView","behavior","window","history","pushState","onDropdownClick","callbacks","mapFoundSectionsToChapters","sectionsFound","postId","partsEnabled","mappedSections","Object","entries","map","key","label","url","items","chapters","unattachedPackagePartIndex","findIndex","sections","activePartIndex","find","activeChapterIndex","hasListItems","undefined","length","onResizeToggleDropdown","autoDropdownEnabled","autoDropdownWidth","width","offsetWidth","isDropdown","onWindowClickCloseDropdown","contains","scrollSmoothly","initWatchForSectionScroll","highlightCurrentSection","enableWatchForSectionScroll","watchForCurrentSection","currentSection","watchForSectionScroll","sectionKeys","keys","scrollPosition","scrollY","currentSectionKey","i","sectionElement","offsetTop"],"sourceRoot":""}