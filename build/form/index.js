(()=>{"use strict";var e,t={988:()=>{const e=window.wp.hooks,t=window.wp.i18n,r=window.wp.blocks,o=window.wp.data;function n(e){var t,r,o="";if("string"==typeof e||"number"==typeof e)o+=e;else if("object"==typeof e)if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(r=n(e[t]))&&(o&&(o+=" "),o+=r)}else for(r in e)e[r]&&(o&&(o+=" "),o+=r);return o}const a=function(){for(var e,t,r=0,o="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=n(e))&&(o&&(o+=" "),o+=t);return o},l=window.wp.blockEditor,s=window.wp.components,i=window.wp.element,c=window.prcIcons,m=[["prc-block/form-submit",{}],["prc-block/form-message",{},[["core/paragraph",{content:"Thank you for your message!"}]]]],p=[["prc-block/form-input-text",{type:"text",label:"Name",required:!0,placeholder:"Enter your name",metadata:{name:"name"}}],["prc-block/form-input-text",{type:"email",label:"Email",required:!0,placeholder:"Enter your email",metadata:{name:"email"}}],["prc-block/form-input-textarea",{label:"Message",required:!0,placeholder:"Enter your message",metadata:{name:"message"}}],...m],u=p,d=window.ReactJSXRuntime;function f({clientId:e}){const r=function(e){return(0,o.useSelect)(t=>{const{getBlock:r}=t("core/block-editor"),o=r(e),n=o?.innerBlocks,a=[],l=e=>{e.forEach(e=>{e.name.startsWith("prc-block/form-")&&(["prc-block/form-field","prc-block/form-message","prc-block/form-submit","prc-block/form-captcha"].includes(e.name)||a.push({blockId:e.clientId,label:e.attributes?.metadata?.name||e.name})),e.innerBlocks&&l(e.innerBlocks)})};return l(n),a},[e])}(e),{selectBlock:n}=(0,o.useDispatch)(l.store);return(0,d.jsx)(s.PanelBody,{title:(0,t.__)("Form Fields"),children:(0,d.jsx)("ul",{children:r.map((e,t)=>(0,d.jsx)("li",{children:(0,d.jsx)(s.Button,{variant:"tertiary",onClick:()=>n(e.blockId),children:e.label})},`${e.blockId}-${t}`))})})}function b({attributes:e,setAttributes:n,clientId:a,displayMessageEditing:u,setDisplayMessageEditing:b}){const{rootBlockNamespace:g}=(0,o.useSelect)(t=>{const{interactiveNamespace:r}=e,{getBlockRootClientId:o,getBlock:n}=t("core/block-editor"),l=n(o(a));return r&&r.length>0?{rootBlockNamespace:r}:{rootBlockNamespace:l&&"core/post-content"!==l?.name?l?.name:"prc-block/form"}},[a,e]),k=(0,o.useSelect)(e=>e("prc-block-library/forms").getForms(),[]),{method:h,action:x,namespace:y,redirectUrl:_,formName:v}=e,[B,w]=(0,i.useState)(v),[S,F]=(0,i.useState)(h),[j,C]=(0,i.useState)(x),[I,M]=(0,i.useState)(y),[E,T]=(0,i.useState)(_),N=(0,i.useMemo)(()=>{const e=`${I}::${j}`;return console.log("actionName",e),e},[I,j]),{replaceInnerBlocks:O,replaceBlock:R}=(0,o.useDispatch)(l.store),[A,z]=(0,i.useState)(!1),D=(0,i.useMemo)(()=>k.filter(e=>"api"===e.method&&e.namespace===g).map(e=>({label:e.label,value:`${e.namespace}::${e.action}`})),[g,k]),U=(0,i.useMemo)(()=>k.filter(e=>"rest"===e.method&&e.namespace===g).map(e=>({label:e.label,value:`${e.namespace}::${e.action}`})),[g,k]),$=(0,i.useMemo)(()=>(console.log("serverMethods...",g,k),k.filter(e=>"server"===e.method&&e.namespace===g).map(e=>({label:e.label,value:`${e.namespace}::${e.action}`}))),[g,k]),P=(0,i.useMemo)(()=>{const e=[{label:"Select an action",value:""}];return"api"===h&&D.length>0?[...e,...D]:"rest"===h&&U.length>0?[...e,...U]:"server"===h&&$.length>0?[...e,...$]:[{label:"No method selected",value:""}]},[h,D,U]),L=(0,i.useCallback)((e,t)=>k.filter(r=>{if(console.log("form",r),r.namespace===e&&r.action===t)return r.template&&r.template.length>0||(r.template=p),r}).pop()||{},[k]),H=(0,i.useMemo)(()=>L(y,x),[y,x]);(0,i.useEffect)(()=>{console.log("updating attributes",B,S,j,I,P),n({formName:B,method:S,action:j,namespace:I,redirectUrl:E})},[B,S,j,I,E]),(0,i.useEffect)(()=>{console.log("getting updates from attributes",v,h,x,y),F(h),C(x),M(y),T(_)},[v,h,x,y,_]);const q=function(e){return(0,o.useSelect)(t=>{const{getBlock:r}=t("core/block-editor"),o=r(e),n=o?.innerBlocks;let a=!1;const l=e=>{e.forEach(e=>{"prc-block/form-message"!==e.name?e.innerBlocks&&l(e.innerBlocks):a=!0})};return l(n),a},[e])}(a);return(0,d.jsxs)(d.Fragment,{children:[q&&(0,d.jsx)(l.BlockControls,{children:(0,d.jsx)(s.ToolbarButton,{icon:()=>(0,d.jsx)(c.Icon,{icon:"message-smile",library:"solid",size:"14px"}),label:u?(0,t.__)("Editing Form Message"):(0,t.__)("Editing Form Fields"),isActive:u,onClick:()=>b(!u)})}),(0,d.jsxs)(l.InspectorControls,{children:[(0,d.jsxs)(s.PanelBody,{title:(0,t.__)("Form Settings"),children:[(0,d.jsx)(s.TextControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,t.__)("Form Name"),value:B,onChange:e=>w(e)}),(0,d.jsx)(s.SelectControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,t.__)("Method"),options:[{label:"API",value:"api"},{label:"REST",value:"rest"}],value:S,onChange:e=>F(e)}),(0,d.jsx)(s.SelectControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,t.__)("Action"),options:P,value:N,onChange:e=>{const[t,r]=e.split("::");C(r),M(t);const o=L(t,r)?.template;o&&o.length>0&&z(!0)}}),(0,d.jsx)(s.TextControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,t.__)("Redirect Target"),value:E,onChange:e=>T(e),help:(0,t.__)('This can be a URL, an email address, or any other value you want to pass to the end of form submission action. More often than not, this is a URL to redirect to after the form has been submitted. You can pass values in the form of %field_name% to insert the value of a form field into the URL. For example, if you want to redirect to a page that displays the value of the "name" field, you can use %name% in the URL.')}),q&&(0,d.jsx)(s.Button,{variant:"secondary",onClick:()=>b(!u),children:u?"Edit Form Fields":"Edit Form Message"}),A&&(0,d.jsxs)(s.Modal,{isOpen:A,onRequestClose:()=>z(!1),title:"Use Form Template?",size:"medium",children:[(0,d.jsx)("p",{children:'This form includes a default template. To use a different set of blocks, click "Start from scratch." If you prefer to use the template, click "Use template."'}),(0,d.jsxs)("div",{style:{display:"flex",gap:"10px"},children:[(0,d.jsx)(s.Button,{variant:"primary",onClick:()=>{console.log("selectedAction",H),z(!1);const e=(0,r.createBlocksFromInnerBlocksTemplate)(H.template);console.log("blocks...",e),R(a,e)},children:"Use template"}),(0,d.jsx)(s.Button,{variant:"secondary",onClick:()=>{z(!1)},children:"Use existing blocks"}),(0,d.jsx)(s.Button,{variant:"tertiary",onClick:()=>{z(!1),O(a,[...(0,r.createBlocksFromInnerBlocksTemplate)(m)])},children:"Start blank"})]})]})]}),(0,d.jsx)(f,{clientId:a})]})]})}const g=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"prc-block/form","title":"Form","description":"A form element with input validation and a centralized form actions registry and api.","category":"common","allowedBlocks":["core/paragraph","core/heading","core/group","core/columns","core/image","core/button","prc-block/form-input-checkbox","prc-block/form-input-password","prc-block/form-input-radio-group","prc-block/form-input-select","prc-block/form-input-text","prc-block/form-input-textarea","prc-block/form-message","prc-block/form-page","prc-block/form-submit"],"keywords":["form","captcha","field","input"],"icon":"feedback","attributes":{"formName":{"type":"string"},"method":{"type":"string","enum":["rest","api"],"default":"api"},"namespace":{"type":"string"},"action":{"type":"string"},"redirectUrl":{"type":"string"}},"supports":{"anchor":true,"className":false,"interactivity":true,"color":{"background":true,"text":true,"link":true,"heading":true,"button":true},"layout":{"type":"constrained","default":{"type":"constrained","orientation":"vertical","verticalAlignment":"center","allowOrientation":true,"contentSize":"420px"},"allowSwitching":true,"allowInheriting":false,"allowVerticalAlignment":true,"allowJustification":true,"allowOrientation":true,"allowSizingOnChildren":true},"spacing":{"blockGap":true,"margin":true,"padding":true,"__experimentalDefaultControls":{"padding":true,"blockGap":true}},"typography":{"fontSize":true,"lineHeight":true,"__experimentalFontFamily":true,"__experimentalFontWeight":true,"__experimentalFontStyle":true,"__experimentalTextTransform":true,"__experimentalTextDecoration":true,"__experimentalLetterSpacing":true,"__experimentalDefaultControls":{"fontSize":true,"__experimentalFontFamily":true}},"__experimentalSelector":"form"},"providesContext":{"form/displayMessage":"displayMessage"},"textdomain":"form","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css","render":"file:./render.php","viewScriptModule":"file:./view/index.js"}'),k={forms:[]},h={registerForm:e=>({type:"REGISTER_FORM",form:e})},x=(0,o.createReduxStore)("prc-block-library/forms",{reducer:function(e=k,t){return"REGISTER_FORM"===t.type?{...e,forms:[...e.forms,t.form]}:e},actions:h,selectors:{getForms:e=>e.forms}}),{registerForm:y}=h,{name:_}=g,v={edit:function({attributes:e,setAttributes:t,clientId:r,__unstableLayoutClassNames:n}){const[s,c]=(0,i.useState)(!1),{hasInnerBlocks:m}=(0,o.useSelect)(e=>{const{getBlock:t}=e(l.store),o=t(r);return{hasInnerBlocks:!(!o||!o.innerBlocks.length)}},[r]),p=(0,l.useBlockProps)({className:a(n,{"is-displaying-form-message":s})}),f=(0,l.useInnerBlocksProps)(p,{template:u,renderAppender:m?void 0:l.InnerBlocks.ButtonBlockAppender});return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(b,{attributes:e,setAttributes:t,clientId:r,displayMessageEditing:s,setDisplayMessageEditing:c}),(0,d.jsx)("form",{...f})]})},save:function({attributes:e}){const t=l.useBlockProps.save({className:"wp-block-prc-block-form"}),r=l.useInnerBlocksProps.save();return(0,d.jsx)("form",{...t,children:r.children})}};(0,o.register)(x),(0,o.dispatch)("prc-block-library/forms").registerForm({label:"Contact Form",description:"Contact form",namespace:"prc-block/form",action:"sendToEmail",method:"rest",template:u}),(0,r.registerBlockType)(_,{...g,...v});const B=["prc-block/form"];(0,e.addFilter)("blockEditor.__unstableCanInsertBlockType","prc-block-library/preventInsertingFormIntoAnotherForm",(e,t,r,{getBlock:o,getBlockParentsByBlockName:n})=>{if("prc-block/form"!==t.name)return e;for(const e of B)if(o(r)?.name===e||n(r,e).length)return!1;return!0})}},r={};function o(e){var n=r[e];if(void 0!==n)return n.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,o),a.exports}o.m=t,e=[],o.O=(t,r,n,a)=>{if(!r){var l=1/0;for(m=0;m<e.length;m++){for(var[r,n,a]=e[m],s=!0,i=0;i<r.length;i++)(!1&a||l>=a)&&Object.keys(o.O).every(e=>o.O[e](r[i]))?r.splice(i--,1):(s=!1,a<l&&(l=a));if(s){e.splice(m--,1);var c=n();void 0!==c&&(t=c)}}return t}a=a||0;for(var m=e.length;m>0&&e[m-1][2]>a;m--)e[m]=e[m-1];e[m]=[r,n,a]},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};o.O.j=t=>0===e[t];var t=(t,r)=>{var n,a,[l,s,i]=r,c=0;if(l.some(t=>0!==e[t])){for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(i)var m=i(o)}for(t&&t(r);c<l.length;c++)a=l[c],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(m)},r=globalThis.webpackChunk_prc_block_library=globalThis.webpackChunk_prc_block_library||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var n=o.O(void 0,[350],()=>o(988));n=o.O(n)})();
//# sourceMappingURL=index.js.map