import*as t from"@wordpress/interactivity";var e={d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const r=(o={getContext:()=>t.getContext,getElement:()=>t.getElement,store:()=>t.store,withSyncEvent:()=>t.withSyncEvent},s={},e.d(s,o),s);var o,s;class n{constructor(t){this.actionUrl=t?.actionUrl,this.message=t.message,this.data=t.data,this.status=t.status}get isSuccess(){return"success"===this.status}get isError(){return"error"===this.status}get isProcessing(){return"processing"===this.status}}const i={STORAGE_KEY_PREFIX:"prc_form_data_",EXPIRY_HOURS:24,getStorageKey(t){return`${this.STORAGE_KEY_PREFIX}${t}`},saveFormData(t,e){try{const r={timestamp:Date.now(),fields:e.filter((t=>t.value&&!["password","hidden"].includes(t.type))).map((t=>({id:t.id,name:t.name,value:t.value,checked:t?.checked||null})))};localStorage.setItem(this.getStorageKey(t),JSON.stringify(r))}catch(t){console.warn("Failed to save form data to localStorage:",t)}},loadFormData(t){try{const e=localStorage.getItem(this.getStorageKey(t));if(!e)return null;const r=JSON.parse(e);return Date.now()>r.timestamp+60*this.EXPIRY_HOURS*60*1e3?(this.clearFormData(t),null):r.fields}catch(t){return console.warn("Failed to load form data from localStorage:",t),null}},clearFormData(t){try{localStorage.removeItem(this.getStorageKey(t))}catch(t){console.warn("Failed to clear form data from localStorage:",t)}},clearExpiredData(){try{const t=Date.now(),e=[];for(let r=0;r<localStorage.length;r++){const o=localStorage.key(r);if(o&&o.startsWith(this.STORAGE_KEY_PREFIX))try{t>JSON.parse(localStorage.getItem(o)).timestamp+60*this.EXPIRY_HOURS*60*1e3&&e.push(o)}catch(t){e.push(o)}}e.forEach((t=>localStorage.removeItem(t)))}catch(t){console.warn("Failed to clear expired form data:",t)}}},{state:a,actions:c}=(0,r.store)("prc-block/form",{state:{success:!1,error:!1,processing:!1,get submissionDisabled(){return!(0,r.getContext)().allowSubmit},get fieldsForSubmission(){const t=(0,r.getContext)(),{formFields:e}=t,o=a.formFields.filter((t=>e.includes(t.id)));return o.push({id:"captchaToken",type:"captchaToken",value:t.captchaToken,required:!1,name:"captchaToken"}),o},get inputType(){(0,r.getContext)();const{attributes:t}=(0,r.getElement)(),{id:e}=t,{formFields:o}=a;return o.find((t=>t.id===e))?.type},get inputValue(){const{attributes:t}=(0,r.getElement)(),{id:e}=t,{formFields:o}=a;return o.find((t=>t.id===e))?.value},get inputName(){const{attributes:t}=(0,r.getElement)(),{id:e}=t,{formFields:o}=a;return o.find((t=>t.id===e))?.name},get inputPlaceholder(){const{attributes:t}=(0,r.getElement)(),{id:e}=t,{formFields:o}=a;return o.find((t=>t.id===e))?.placeholder},get isInputHidden(){const{attributes:t}=(0,r.getElement)(),{id:e}=t,{formFields:o}=a;return o.find((t=>t.id===e))?.hidden},get isInputDisabled(){const{attributes:t}=(0,r.getElement)(),{id:e}=t,{formFields:o}=a;return o.find((t=>t.id===e))?.disabled},get isInputReadOnly(){const{attributes:t}=(0,r.getElement)(),{id:e}=t,{formFields:o}=a;return o.find((t=>t.id===e))?.readOnly},get isInputRequired(){const{attributes:t}=(0,r.getElement)(),{id:e}=t,{formFields:o}=a;return o.find((t=>t.id===e))?.required},get isInputChecked(){const{attributes:t}=(0,r.getElement)(),{id:e}=t,{formFields:o}=a;return o.find((t=>t.id===e))?.checked},get isInputError(){const{formFields:t}=a,{attributes:e}=(0,r.getElement)(),{id:o}=e;return t.find((t=>t.id===o))?.error||a.error},get isInputSuccess(){return a.success},get isInputProcessing(){return a.processing},get hasErrors(){return(0,r.getContext)().errors.length>0},get formMessage(){const t=(0,r.getContext)();return t?.formMessage||!1}},actions:{updateInputStateProp:(t,e,o)=>{const{formFields:s}=a,n=s.find((e=>e.id===t));n&&(n[e]=o);const{formId:c}=(0,r.getContext)();a.formFields=s,i.saveFormData(c,s)},onLabelClick:(0,r.withSyncEvent)((t=>{const e=t.target.nextElementSibling;e&&["INPUT","SELECT","TEXTAREA"].includes(e.tagName)&&e.focus()})),getInputStateProp:(t,e)=>{const{formFields:r}=a;return r.find((e=>e.id===t))?.[e]},onInputChange:(0,r.withSyncEvent)((t=>{const{value:e,id:r}=t.target;c.updateInputStateProp(r,"value",e),c.updateInputStateProp(r,"error",!1)})),onInputCheckboxClick:(0,r.withSyncEvent)((t=>{const{checked:e,id:r}=t.target;c.updateInputStateProp(r,"checked",e),c.updateInputStateProp(r,"error",!1)})),onInputFocus:(0,r.withSyncEvent)((t=>{const{id:e}=t.target;c.updateInputStateProp(e,"error",!1)})),onInputBlur:(0,r.withSyncEvent)((t=>{})),onInputMouseEnter:(0,r.withSyncEvent)((t=>{})),onInputMouseLeave:(0,r.withSyncEvent)((t=>{})),checkForRequiredFieldsWithoutValues:()=>{const t=(0,r.getContext)(),{fieldsForSubmission:e}=a;let o=!1;e.forEach((t=>{!t.required||("checkbox"===t.type||"radio"===t.type?t.checked:t.value)?c.updateInputStateProp(t.id,"error",!1):(c.updateInputStateProp(t.id,"error",!0),o=!0)})),t.stopProcessing=o},onSubmit:(0,r.withSyncEvent)((async t=>{t.preventDefault();const e=(0,r.getContext)();c.checkForRequiredFieldsWithoutValues(),e.stopProcessing||(e.submissionProcessing=null,e.captchaHidden=!1)})),onReset:()=>{const t=(0,r.getContext)();t.submissionProcessing=!1,t.captchaHidden=!0,t.submitButtonText="Submit",t.stopProcessing=!1,t.allowSubmit=!0,t.errors=[],t._isSubmitting=!1,i.clearFormData(t.formId)},onErrorClick:(0,r.withSyncEvent)((t=>{t.preventDefault();const{actionUrl:e}=t.target.dataset;e&&(window.location.href=e),c.onReset()}))},callbacks:{onFormMount:()=>{const{ref:t,attributes:e}=(0,r.getElement)();let{id:o}=e;o||(o=`prc-block-form-${Math.random().toString(36).substring(2,15)}`);const s=(t=>{const e=t.querySelectorAll("input, select, textarea, .wp-block-prc-block-form-input-password"),r=[];return e.forEach((t=>{"password"!==t.type&&t.id&&r.push(t.id)})),r})(t),n=(0,r.getContext)();n.formId=o,n.formFields=s,i.clearExpiredData();const c=i.loadFormData(o);c&&(a.formFields=a.formFields.map((t=>{const e=c.find((e=>e.id===t.id));return e&&(t.value=e?.value,t.checked=e?.checked),t})))},onCaptchaPassing:()=>{const t=(0,r.getContext)();t.captchaPassed&&(t.captchaHidden=!0)},onProcessing:()=>{const t=(0,r.getContext)();t.submissionProcessing?t.submitButtonText="Processing...":t.submitButtonText="Submit"},*sendSubmission(){const t=(0,r.getContext)(),{captchaPassed:e,captchaToken:o,nonceName:s,nonceToken:c,submissionProcessing:u,stopProcessing:d,submitMethod:l,formId:m,formName:g,redirectUrl:p}=t;if(!e||d||!1===u||!0===u||t._isSubmitting)return;t._isSubmitting=!0,t.captchaHidden=!0,t.submissionProcessing=!0;const{method:h,action:f,namespace:S}=l,{fieldsForSubmission:b}=a,E=[...b,{id:"nonce",name:s,type:"nonceToken",value:c}];if("rest"===h){const e=f.replace(/([A-Z])/g,"-$1").toLowerCase();try{const r=yield window.wp.apiFetch({path:`/prc-api/v3/form/${e}?nonce=${c}`,method:"POST",data:{formName:g,formId:m,redirectTarget:p,formFields:E}}),o=new n(r);o.isSuccess?(a.success=!0,t.formMessage=o?.message||"Form submitted successfully."):a.error=!0}catch(e){console.error("onSubmit (REST) error:",e),a.error=!0,t.errors.push({id:`error-${Math.random().toString(36).substring(2,15)}`,message:e?.message||"An error occurred.",actionUrl:e?.actionUrl||null})}t.submissionProcessing=!1,t._isSubmitting=!1}else if("api"===h){const e=yield(0,r.store)(S);if(e?.actions[f])try{const r=yield e.actions[f](E),o=new n(r);o.isSuccess?(i.clearFormData(m),a.success=!0,p?window.location.href=p:t.formMessage=o?.message||"Form submitted successfully.",o.actionUrl&&setTimeout((()=>{window.location.href=o.actionUrl}),1e3)):(a.error=!0,t.errors.push({id:`error-${Math.random().toString(36).substring(2,15)}`,message:o?.message||"An error occurred.",actionUrl:o?.actionUrl||null}))}catch(e){console.error("onSubmit error",e),a.error=!0,t.errors.push({id:`error-${Math.random().toString(36).substring(2,15)}`,message:e?.message||"An error occurred.",actionUrl:e?.actionUrl||null})}finally{t.submissionProcessing=!1,t._isSubmitting=!1}}i.clearFormData(m)}}});
//# sourceMappingURL=index.js.map