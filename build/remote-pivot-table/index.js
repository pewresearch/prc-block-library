(()=>{"use strict";const e=window.wp.i18n,t=window.wp.blocks,o=window.wp.element,l=window.wp.blockEditor,a=window.wp.components,n=window.wp.data,r=window.ReactJSXRuntime,s=window.prcIcons,i=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"prc-block/remote-pivot-table","version":"1.0.0","title":"Remote Pivot Table","description":"Pivots the data of a remote tabular data source allowing for pseudo-pivot-table like functionality. Select a data source like column or row and then select the columns to pivot by.","category":"media","keywords":["remote","data","row","table","pivot","tabular"],"attributes":{"primaryKey":{"type":"string"},"selectedColumns":{"type":"array","items":{"type":"string"},"default":[]},"dataSource":{"type":"string","enum":["column","row"],"default":"row"}},"supports":{"anchor":true,"html":false},"usesContext":["remote-data-blocks/remoteData","remote-data-blocks/pivotedData"],"textdomain":"remote-pivot-table","editorScript":"file:./index.js","style":"file:./style-index.css"}'),{name:c}=i,u={edit:function({attributes:s,setAttributes:i,context:c,clientId:u,isSelected:m}){const{dataSource:p,primaryKey:d,pivotedData:b,selectedColumns:v}=s,y=c?.["remote-data-blocks/remoteData"]||{},[f,h]=(0,o.useState)(!1),[k,w]=(0,o.useState)(""),{insertBlock:_}=(0,n.useDispatch)("core/block-editor"),x=(0,l.useBlockProps)({}),g=(0,l.useInnerBlocksProps)({className:"prc-block-remote-pivot-table__template"},{}),j=(0,o.useMemo)(()=>{const{results:e}=y;if(!e)return[];const t=e[0].result;return t?Object.keys(t):[]},[y]),C=(0,o.useMemo)(()=>{const{results:e}=y;return e?e.map(e=>e.result):[]},[y]);return(0,o.useEffect)(()=>{const e={};"row"===p?(C.forEach(t=>{const o=t[d]?.value;o&&(e[o]=Object.fromEntries(Object.entries(t).filter(([e])=>e!==d&&v.includes(e))))}),console.log("pivoted rows:",e)):"column"===p&&(j.forEach(t=>{v.includes(t)&&(e[t]={},C.forEach(o=>{const l=o[d]?.value,a=o[t];e[t][l]=a}))}),console.log("pivoted columns:",e)),i({pivotedData:e})},[p,v,d,C,j]),(0,r.jsxs)("div",{...x,children:[(0,r.jsxs)(l.InspectorControls,{children:[(0,r.jsx)(a.PanelBody,{title:(0,e.__)("Remote Data: Pivot Table","remote-pivot-table"),children:(0,r.jsxs)("div",{children:[(0,r.jsx)(a.SelectControl,{label:(0,e.__)("Selected Columns","remote-pivot-table"),multiple:!0,value:v,onChange:e=>i({selectedColumns:e}),options:j.map(e=>({value:e,label:e}))}),(0,r.jsx)(a.SelectControl,{label:(0,e.__)("Data Source","remote-pivot-table"),value:p,onChange:e=>i({dataSource:e}),options:[{value:"column",label:(0,e.__)("Column","remote-pivot-table")},{value:"row",label:(0,e.__)("Row","remote-pivot-table")}]}),(0,r.jsx)(a.SelectControl,{label:(0,e.__)("Primary Key","remote-pivot-table"),value:d,onChange:e=>i({primaryKey:e}),options:j.map(e=>({value:e,label:e}))})]})}),(0,r.jsxs)(a.PanelBody,{title:(0,e.__)("Column Sum Block Binding","remote-pivot-table"),initialOpen:!1,children:[(0,r.jsx)(a.PanelRow,{children:(0,r.jsx)("p",{style:{margin:0},children:(0,e.__)("Create a block that displays the sum of values for a selected column.","remote-pivot-table")})}),(0,r.jsx)(a.PanelRow,{children:(0,r.jsx)(a.Button,{variant:"secondary",onClick:()=>h(!0),disabled:0===j.length,children:(0,e.__)("Add Column Sum Block","remote-pivot-table")})})]})]}),f&&(0,r.jsx)(a.Modal,{title:(0,e.__)("Select Column for Sum Block","remote-pivot-table"),onRequestClose:()=>h(!1),className:"prc-block-remote-pivot-table-column-modal",children:(0,r.jsxs)("div",{style:{padding:"16px"},children:[(0,r.jsx)(a.SelectControl,{label:(0,e.__)("Column to Sum","remote-pivot-table"),value:k,onChange:w,options:[{value:"",label:(0,e.__)("Select a column...","remote-pivot-table")},...j.map(e=>({value:e,label:e}))]}),(0,r.jsxs)("div",{style:{display:"flex",gap:"8px",marginTop:"16px"},children:[(0,r.jsx)(a.Button,{variant:"primary",onClick:()=>{if(!k)return;const o=(0,t.createBlock)("core/paragraph",{content:(0,e.__)("Column Sum","remote-pivot-table"),metadata:{bindings:{content:{source:"prc-block/remote-pivot-table-sum",args:{column:k}}}}});_(o,void 0,u),h(!1),w("")},disabled:!k,children:(0,e.__)("Insert Block","remote-pivot-table")}),(0,r.jsx)(a.Button,{variant:"secondary",onClick:()=>h(!1),children:(0,e.__)("Cancel","remote-pivot-table")})]})]})}),(0,r.jsx)("div",{...g})]})},save:function({attributes:e}){return(0,r.jsx)(l.InnerBlocks.Content,{})},icon:function(){return(0,r.jsx)(s.Icon,{icon:"table-pivot",library:"light"})}};(0,t.registerBlockType)(c,{...i,...u}),(0,t.registerBlockBindingsSource)({name:"prc-block/remote-pivot-table-sum",label:(0,e.__)("Remote Pivot Table Sum","prc-block-library"),usesContext:["remote-data-blocks/remoteData"],getValues({select:e,clientId:t,context:o,bindings:l}){const{content:a}=l,{args:n}=a,{column:r}=n||{};if(!r)return{content:"0"};const s=o?.["remote-data-blocks/remoteData"]||{},{results:i}=s;if(!i||!Array.isArray(i))return{content:"0"};const c=function(e,t){let o=0;for(const l of e){if(!l?.result||"object"!=typeof l.result)continue;const e=l.result;if(!(t in e))continue;const a=e[t],n=Array.isArray(a)||"object"==typeof a&&null!==a&&"value"in a?a.value:a;("number"==typeof n||"string"==typeof n&&!isNaN(parseFloat(n)))&&(o+=parseFloat(n))}return o}(i,r);return{content:c.toString()}}})})();
//# sourceMappingURL=index.js.map