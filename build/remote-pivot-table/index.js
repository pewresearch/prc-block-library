(()=>{"use strict";const e=window.wp.i18n,t=window.wp.blocks,o=window.wp.element,l=window.wp.blockEditor,a=window.wp.components,r=window.ReactJSXRuntime,s=window.prcIcons,n=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"prc-block/remote-pivot-table","version":"1.0.0","title":"Remote Pivot Table","description":"Pivots the data of a remote tabular data source allowing for pseudo-pivot-table like functionality. Select a data source like column or row and then select the columns to pivot by.","category":"media","keywords":["remote","data","row","table","pivot","tabular"],"attributes":{"primaryKey":{"type":"string"},"selectedColumns":{"type":"array","items":{"type":"string"},"default":[]},"dataSource":{"type":"string","enum":["column","row"],"default":"row"}},"supports":{"anchor":true,"html":false},"usesContext":["remote-data-blocks/remoteData","remote-data-blocks/pivotedData"],"textdomain":"remote-pivot-table","editorScript":"file:./index.js","style":"file:./style-index.css"}'),{name:i}=n,c={edit:function({attributes:t,setAttributes:s,context:n,clientId:i,isSelected:c}){const{dataSource:u,primaryKey:p,pivotedData:m,selectedColumns:d}=t,b=n?.["remote-data-blocks/remoteData"]||{},v=(0,l.useBlockProps)({}),w=(0,l.useInnerBlocksProps)({className:"prc-block-remote-pivot-table__template"},{}),y=(0,o.useMemo)(()=>{const{results:e}=b;if(!e)return[];const t=e[0].result;return t?Object.keys(t):[]},[b]),f=(0,o.useMemo)(()=>{const{results:e}=b;return e?e.map(e=>e.result):[]},[b]);return(0,o.useEffect)(()=>{const e={};"row"===u?(f.forEach(t=>{const o=t[p]?.value;o&&(e[o]=Object.fromEntries(Object.entries(t).filter(([e])=>e!==p&&d.includes(e))))}),console.log("pivoted rows:",e)):"column"===u&&(y.forEach(t=>{d.includes(t)&&(e[t]={},f.forEach(o=>{const l=o[p]?.value,a=o[t];e[t][l]=a}))}),console.log("pivoted columns:",e)),s({pivotedData:e})},[u,d,p,f,y]),(0,r.jsxs)("div",{...v,children:[(0,r.jsx)(l.InspectorControls,{children:(0,r.jsx)(a.PanelBody,{title:(0,e.__)("Remote Data: Pivot Table","remote-pivot-table"),children:(0,r.jsxs)("div",{children:[(0,r.jsx)(a.SelectControl,{label:(0,e.__)("Selected Columns","remote-pivot-table"),multiple:!0,value:d,onChange:e=>s({selectedColumns:e}),options:y.map(e=>({value:e,label:e}))}),(0,r.jsx)(a.SelectControl,{label:(0,e.__)("Data Source","remote-pivot-table"),value:u,onChange:e=>s({dataSource:e}),options:[{value:"column",label:(0,e.__)("Column","remote-pivot-table")},{value:"row",label:(0,e.__)("Row","remote-pivot-table")}]}),(0,r.jsx)(a.SelectControl,{label:(0,e.__)("Primary Key","remote-pivot-table"),value:p,onChange:e=>s({primaryKey:e}),options:y.map(e=>({value:e,label:e}))})]})})}),(0,r.jsx)("div",{...w})]})},save:function({attributes:e}){return(0,r.jsx)(l.InnerBlocks.Content,{})},icon:function(){return(0,r.jsx)(s.Icon,{icon:"table-pivot",library:"light"})}};(0,t.registerBlockType)(i,{...n,...c})})();
//# sourceMappingURL=index.js.map