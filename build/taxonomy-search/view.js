import{getContext as e,getElement as t,store as o,withScope as n,withSyncEvent as s}from"@wordpress/interactivity";const{apiFetch:i}=window.wp,{addQueryArgs:r}=window.wp.url,{decodeEntities:a}=window.wp.htmlEntities,{state:c,actions:l}=o("prc-block/taxonomy-search",{state:{get inputValue(){const{attributes:e}=t(),{id:o}=e,{formFields:n}=c;return n.find(e=>e.id===o)?.value},get inputName(){const t=e(),{taxonomy:o}=t;return`search__${o}`},get inputPlaceholder(){const{attributes:e}=t(),{id:o}=e,{formFields:n}=c;return n.find(e=>e.id===o)?.placeholder}},actions:{doSearch:async(e,t,o=0)=>new Promise(n=>{const s={per_page:25};""!==t&&(s.taxonomy=t),""!==e&&(s.search=e),0!==o&&""!==o&&(s.parent_term_id=o);const c={method:"GET",path:r("/prc-api/v3/blocks/taxonomy-search",s)};console.log("doSearch request",c),i(c).then(e=>{console.log("doSearch response",e);const t=e.map(e=>({key:e.id,id:e.id,url:e.link,description:a(e.description),label:a(e.name)}));n(t)})}),onInputFocus:s(t=>{e().isActive=!0}),onInputBlur:s(t=>{const o=e();setTimeout(()=>{o.isActive=!1},300)}),onInputChange:s(o=>{const{value:n}=o.target,s=e(),{ref:i}=t(),{id:r}=i,{formFields:a}=c,l=a.find(e=>e.id===r);l&&(l.value=n),c.formFields=a,s.searchValue=n})},callbacks:{showResults:()=>{const t=e();return t.results&&t.results.length>=1&&t.isActive},onSearchValueChange:s(()=>{const t=e(),{searchValue:o,taxonomy:s}=t;o&&o.length>4&&n(setTimeout(()=>{console.log("onSearchValueChange",{...t}),l.doSearch(o,s).then(e=>{t.results=e})},1200))}),onEscKey:t=>{27===t.keyCode&&(e().isActive=!1)}}});
//# sourceMappingURL=view.js.map