import*as e from"@wordpress/interactivity";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const n=(a={getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store,withScope:()=>e.withScope,withSyncEvent:()=>e.withSyncEvent},l={},t.d(l,a),l),{apiFetch:o}=window.wp,{addQueryArgs:r}=window.wp.url,{decodeEntities:s}=window.wp.htmlEntities,{state:i,actions:c}=(0,n.store)("prc-block/taxonomy-search",{state:{get inputValue(){const{attributes:e}=(0,n.getElement)(),{id:t}=e,{formFields:o}=i;return o.find((e=>e.id===t))?.value},get inputName(){const e=(0,n.getContext)(),{taxonomy:t}=e;return`search__${t}`},get inputPlaceholder(){const{attributes:e}=(0,n.getElement)(),{id:t}=e,{formFields:o}=i;return o.find((e=>e.id===t))?.placeholder}},actions:{doSearch:async(e,t,n=0)=>new Promise((i=>{const c={per_page:25};""!==t&&(c.taxonomy=t),""!==e&&(c.search=e),0!==n&&""!==n&&(c.parent_term_id=n);const a={method:"GET",path:r("/prc-api/v3/blocks/taxonomy-search",c)};console.log("doSearch request",a),o(a).then((e=>{console.log("doSearch response",e);const t=e.map((e=>({key:e.id,id:e.id,url:e.link,description:s(e.description),label:s(e.name)})));i(t)}))})),onInputFocus:(0,n.withSyncEvent)((e=>{(0,n.getContext)().isActive=!0})),onInputBlur:(0,n.withSyncEvent)((e=>{const t=(0,n.getContext)();setTimeout((()=>{t.isActive=!1}),300)})),onInputChange:(0,n.withSyncEvent)((e=>{const{value:t}=e.target,o=(0,n.getContext)(),{ref:r}=(0,n.getElement)(),{id:s}=r,{formFields:c}=i,a=c.find((e=>e.id===s));a&&(a.value=t),i.formFields=c,o.searchValue=t}))},callbacks:{showResults:()=>{const e=(0,n.getContext)();return e.results&&e.results.length>=1&&e.isActive},onSearchValueChange:(0,n.withSyncEvent)((()=>{const e=(0,n.getContext)(),{searchValue:t,taxonomy:o}=e;t&&t.length>4&&(0,n.withScope)(setTimeout((()=>{console.log("onSearchValueChange",{...e}),c.doSearch(t,o).then((t=>{e.results=t}))}),1200))})),onEscKey:e=>{27===e.keyCode&&((0,n.getContext)().isActive=!1)}}});var a,l;
//# sourceMappingURL=view.js.map